<!DOCTYPE html>
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <meta charset="utf-8">
  <script src='vendor/three.js/build/three.js'></script>
  <script src='vendor/three.js/examples/js/controls/OrbitControls.js'></script>
  <script src='../threex.planets.js'></script>
  <link rel="stylesheet" href="orrery.css">
<body id="map" style='margin: 0px; overflow: hidden; text-align:center;'><script>

  // init renderer
  var renderer = new THREE.WebGLRenderer({
   antialias : true
  });
  renderer.setClearColor("#000");
  renderer.setSize( window.innerWidth, window.innerHeight );
  document.body.appendChild( renderer.domElement );

  // array of functions for the rendering loop
  var onRenderFcts= [], earth, moon, rot= [];

  // init scene and camera
  var scene = new THREE.Scene();
  var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.01, 10000);
  camera.position.z = 10;
  //camera.position.x = -1;
  var controls = new THREE.OrbitControls(camera)

  var light = new THREE.AmbientLight(0x000033);
  scene.add(light);
    
	var light	= new THREE.DirectionalLight(0xffffff, 1);
	light.position.set(-100, 0, 0);
	scene.add(light);

  // stellar background
  var starSphere	= THREEx.Planets.createStarfield()
	scene.add(starSphere)

  // radius & initial position of the moon "orbit"
  var radius = 4, theta = Math.PI * 1.5;

  // the Earth mesh
  var sun = THREEx.Planets.create("Sun");
  sun.position.set(-100, 0, 0);

  scene.add(sun);
  
  // the Earth mesh
  earth = THREEx.Planets.create("Earth");
  scene.add(earth);
  // rotation speed
  rot.push(THREE.Math.degToRad(1/THREEx.Planets.params.ter.rot));
  // the Moon mesh
  moon = THREEx.Planets.create("Moon");
  // initial position
  moon.position.set(Math.sin(theta) * radius, 0, Math.cos(theta) * radius);
  scene.add(moon);
  // rotaion/orbital speed
  rot.push(THREE.Math.degToRad(1/THREEx.Planets.params.lun.rot));

  // handle window resize
  window.addEventListener('resize', function(){
    renderer.setSize( window.innerWidth, window.innerHeight )
    camera.aspect = window.innerWidth / window.innerHeight
    camera.updateProjectionMatrix()  
  }, false);

  
  // render the scene
  onRenderFcts.push(function(){
    // turn the Earth 1 step
    earth.rotateOnAxis( new THREE.Vector3( 0, 1, 0 ), rot[0]);
    // spin the clouds a bit faster
    earth.traverse(function(child) {
      if (child.name.search("cloud") !== -1) child.rotateOnAxis( new THREE.Vector3( 0, 1, 0 ), 0.005);
    });

    // turn the Moon and move it at same speed
    moon.rotateOnAxis( new THREE.Vector3( 0, 1, 0 ), rot[1]);
    theta += rot[1];
    moon.position.set(Math.sin(theta) * radius, 0, Math.cos(theta) * radius);

    renderer.render(scene, camera);  
  });
 
  // run the rendering loop
  var lastTimeMsec= null;
  requestAnimationFrame(function animate(nowMsec) {
    // keep looping
    requestAnimationFrame(animate);
    // measure time
    lastTimeMsec = lastTimeMsec || nowMsec-1000/60;
    var deltaMsec = Math.min(200, nowMsec - lastTimeMsec);
    lastTimeMsec = nowMsec;
    // call each update function
    onRenderFcts.forEach(function(onRenderFct) {
      onRenderFct(deltaMsec/1000, nowMsec/1000);
    })
  })
 
 
</script></body>
